---
layout: post
title: "模板方法模式"
categories: 设计模式
tags: 设计模式
author: August
typora-root-url: ..
---

* content
{:toc}


本文介绍模板方法模式定义、结构、特点、适用场景、代码实现。



# 模板方法模式



## 1 模式的定义

**模板方法**（Template Method）是一种行为设计模式，它在超类中定义了一个算法的　框架，允许子类在不修改结构　的情况下重写算法的特定步骤。



## 2 模式的结构

### 2.1 结构图

![模板方法设计模式的结构](/media/image/2022-10-16-模板方法模式/Template.png)

### 2.2 参与者

1. **抽象类**（AbstractClass） 会声明作为算法步骤的方法， 以及依次调用它们的实际模板方法。 算法步骤可以被声明为“抽象”类型，也可以提供一些默认实现。
2. **具体类**（ConcreteClass）可以重写所有步骤，但不能重写模板方法自身。



## 3 模式分析

### 3.1 优点

- 你可仅允许客户端重写一个大型算法中的特定部分，使得算法其他部分修改对其所造成的影响减小。
- 你可将重复代码提取到一个超类中。

### 3.2 缺点

- 部分客户端可能会受到算法框架的限制。
- 通过子类抑制默认步骤实现可能会导致违反里氏替换原则。
- 模板方法中的步骤越多，其维护工作就可能会越困难。



## 4 适用环境

- 当你只希望客户端扩展某个特定算法步骤，而不是整个算法或其结构时，可使用模板方法模式。

模板方法将整个算法转换为一系列独立的步骤，以便子类能对其进行扩展，同时还可让超类中所定义的结构保持完整。

- 当多个类的算法除一些细微不同之外几乎完全一样时，你可使用该模式。但其后果就是，只要算法发生变化，你就可能需要修改所有的类。

在将算法转换为模板方法时，你可将相似的实现步骤提取到超类中以去除重复代码。子类间各不同的代码可继续保留在子类中。



## 5 实现方式

1. 分析目标算法，确定能否将其分解为多个步骤。从所有子类的角度出发，考虑哪些步骤能够通用，哪些步骤各不相同。
2. 创建抽象基类并声明一个模板方法和代表算法步骤的一系列抽象方法。 在模板方法中根据算法结构依次调用相应步骤。可用 final“最终”修饰模板方法以防止子类对其进行重写。
3. 虽然可将所有步骤全都设为抽象类型，但默认实现可能会给部分步骤带来好处，因为子类无需实现那些方法。
4. 可考虑在算法的关键步骤之间添加钩子。
5. 为每个算法变体新建一个具体子类，它必须实现所有的抽象步骤，也可以重写部分可选步骤。



## 6 代码实现

[https://github.com/august295/DesignPatternCode](https://github.com/august295/DesignPatternCode)



## 参考

[1] [https://refactoringguru.cn/design-patterns/template-method](https://refactoringguru.cn/design-patterns/template-method)
